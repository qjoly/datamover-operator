<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>PVC Cloning - Datamover Operator</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">Datamover Operator</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">Welcome aboard!</a>
<li class="chapter" data-path="automatic-cleanup/">
<a href="../automatic-cleanup/">Automatic Cleanup</a>
<li class="chapter" data-path="container-image-configuration/">
<a href="../container-image-configuration/">Container Image Configuration</a>
<li class="chapter" data-path="data-synchronization/">
<a href="../data-synchronization/">Data Synchronization</a>
<li class="chapter" data-path="metrics-and-monitoring/">
<a href="../metrics-and-monitoring/">Metrics and Monitoring</a>
<li class="chapter active" data-path="pvc-cloning/">
<a href="./">PVC Cloning</a>
<li class="chapter" data-path="timestamp-organization/">
<a href="../timestamp-organization/">Timestamp Organization</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="pvc-cloning">PVC Cloning</h1>
<p>This document explains how PVC (PersistentVolumeClaim) cloning works in the DataMover Operator and the requirements for successful cloning operations.</p>
<h2 id="overview">Overview</h2>
<p>PVC cloning is the foundation of the DataMover Operator. It creates a copy of an existing PVC without requiring volume snapshots, allowing data to be safely backed up while the original application continues running.</p>
<h2 id="how-pvc-cloning-works">How PVC Cloning Works</h2>
<h3 id="clone-creation-process">Clone Creation Process</h3>
<ol>
<li><strong>Source PVC Verification</strong>: The operator checks that the source PVC exists and is bound</li>
<li><strong>Clone PVC Creation</strong>: Creates a new PVC with <code>dataSource</code> pointing to the source PVC</li>
<li><strong>Volume Provisioning</strong>: The CSI driver creates a new volume as a clone of the source</li>
<li><strong>Binding</strong>: The cloned PVC becomes bound and ready for use</li>
</ol>
<h3 id="clone-naming-convention">Clone Naming Convention</h3>
<p>Cloned PVCs follow this naming pattern:</p>
<pre><code>&lt;source-pvc-name&gt;-cloned-&lt;timestamp&gt;
</code></pre>
<p>Example:
- Source PVC: <code>web-app-data</code>
- Cloned PVC: <code>web-app-data-cloned-20240806143052</code></p>
<h3 id="compatible-csi-drivers">Compatible CSI Drivers</h3>
<table>
<thead>
<tr>
<th>CSI Driver</th>
<th>Clone Support</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS EBS CSI</td>
<td>✅ Yes</td>
<td>Supports cross-AZ cloning</td>
</tr>
<tr>
<td>GCE PD CSI</td>
<td>✅ Yes</td>
<td>Regional and zonal disks</td>
</tr>
<tr>
<td>Azure Disk CSI</td>
<td>✅ Yes</td>
<td>Premium and Standard SSDs</td>
</tr>
<tr>
<td>vSphere CSI</td>
<td>✅ Yes</td>
<td>vSAN and VMFS datastores</td>
</tr>
<tr>
<td>Ceph CSI</td>
<td>✅ Yes</td>
<td>RBD/CephFS clone feature</td>
</tr>
<tr>
<td>OpenEBS</td>
<td>⚠️ Partial</td>
<td>Depends on storage engine</td>
</tr>
</tbody>
</table>
<h2 id="clone-configuration">Clone Configuration</h2>
<h3 id="basic-clone-specification">Basic Clone Specification</h3>
<p>The DataMover operator automatically handles clone creation. You only need to specify the source PVC:</p>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: backup-web-data
spec:
  sourcePvc: &quot;web-app-data&quot;  # Source PVC to clone
  secretName: &quot;storage-credentials&quot;
</code></pre>
<h3 id="clone-behavior">Clone Behavior</h3>
<ul>
<li><strong>Storage Class</strong>: Clones inherit the storage class of the source PVC</li>
<li><strong>Access Modes</strong>: Clones inherit access modes from the source PVC</li>
<li><strong>Size</strong>: Clones have the same size as the source PVC</li>
<li><strong>Labels</strong>: Clones get operator-specific labels for tracking</li>
</ul>
<h2 id="clone-lifecycle-management">Clone Lifecycle Management</h2>
<h3 id="automatic-cleanup">Automatic Cleanup</h3>
<p>When <code>deletePvcAfterBackup</code> is enabled, clones are automatically deleted after successful backup:</p>
<pre><code class="language-yaml">spec:
  sourcePvc: &quot;web-app-data&quot;
  secretName: &quot;storage-credentials&quot;
  deletePvcAfterBackup: true  # Auto-delete clone after backup
</code></pre>
<h3 id="manual-cleanup">Manual Cleanup</h3>
<p>If automatic cleanup is disabled, you can manually clean up clones:</p>
<pre><code class="language-bash"># List clones created by the operator
kubectl get pvc -l app.kubernetes.io/created-by=datamover-operator

# Delete specific clone
kubectl delete pvc restored-web-app-data-20240806143052

# Delete all operator-created clones
kubectl delete pvc -l app.kubernetes.io/created-by=datamover-operator
</code></pre>
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="clone-creation-time">Clone Creation Time</h3>
<p>Clone creation time depends on:</p>
<ul>
<li><strong>Storage Backend</strong>: NVMe SSDs are faster than HDDs</li>
<li><strong>Volume Size</strong>: Larger volumes take longer to clone</li>
<li><strong>CSI Driver Implementation</strong>: Some drivers use copy-on-write, others full copy</li>
<li><strong>Network Latency</strong>: For network-attached storage</li>
</ul>
<h3 id="resource-usage">Resource Usage</h3>
<p>During cloning:</p>
<ul>
<li><strong>Storage</strong>: Temporary storage equal to source PVC size</li>
<li><strong>I/O</strong>: Minimal impact on source PVC performance</li>
<li><strong>Network</strong>: Bandwidth usage depends on storage backend</li>
</ul>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Schedule During Low Traffic</strong>: Clone during maintenance windows when possible</li>
<li><strong>Monitor Storage Usage</strong>: Ensure sufficient storage for clones</li>
<li><strong>Use Fast Storage Classes</strong>: Clone to high-performance storage when available</li>
<li><strong>Enable Auto-Cleanup</strong>: Reduce storage waste with automatic cleanup</li>
</ol>
<h2 id="troubleshooting-clone-issues">Troubleshooting Clone Issues</h2>
<h3 id="common-problems">Common Problems</h3>
<h4 id="1-clone-creation-fails">1. Clone Creation Fails</h4>
<p><strong>Error</strong>: <code>Failed to create cloned PVC</code></p>
<p><strong>Possible Causes</strong>:
- CSI driver doesn't support cloning
- Insufficient storage quota
- Source PVC is not bound
- Storage class restrictions</p>
<p><strong>Diagnosis</strong>:</p>
<pre><code class="language-bash"># Check source PVC status
kubectl get pvc &lt;source-pvc-name&gt;

# Check storage class
kubectl describe storageclass &lt;storage-class-name&gt;

# Check CSI driver capabilities
kubectl describe csidriver &lt;csi-driver-name&gt;
</code></pre>
<h4 id="2-clone-stuck-in-pending">2. Clone Stuck in Pending</h4>
<p><strong>Error</strong>: Clone PVC remains in <code>Pending</code> state</p>
<p><strong>Possible Causes</strong>:
- No available storage
- Node affinity conflicts
- CSI driver issues</p>
<p><strong>Diagnosis</strong>:</p>
<pre><code class="language-bash"># Check clone PVC events
kubectl describe pvc &lt;clone-pvc-name&gt;

# Check storage capacity
kubectl get pv

# Check node availability
kubectl get nodes
</code></pre>
<h4 id="3-clone-performance-issues">3. Clone Performance Issues</h4>
<p><strong>Error</strong>: Clone creation is very slow</p>
<p><strong>Solutions</strong>:
- Use faster storage classes
- Check storage backend performance
- Verify network connectivity
- Consider off-peak scheduling</p>
<h3 id="debug-commands">Debug Commands</h3>
<pre><code class="language-bash"># Monitor clone creation
kubectl get pvc -w

# Check detailed clone events
kubectl describe pvc &lt;clone-pvc-name&gt;

# View operator logs for clone operations
kubectl logs -n datamover-operator-system deployment/datamover-operator-controller-manager | grep -i clone

# Check storage class details
kubectl describe storageclass &lt;storage-class&gt;
</code></pre>
<h2 id="advanced-clone-scenarios">Advanced Clone Scenarios</h2>
<h3 id="cross-namespace-cloning">Cross-Namespace Cloning</h3>
<p>Clones are created in the same namespace as the DataMover resource:</p>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: cross-ns-backup
  namespace: backup-namespace  # Clone created here
spec:
  sourcePvc: &quot;app-data&quot;  # Must exist in backup-namespace
  secretName: &quot;storage-credentials&quot;
</code></pre>
<h3 id="multiple-clones-from-same-source">Multiple Clones from Same Source</h3>
<p>You can create multiple DataMover resources from the same source PVC:</p>
<pre><code class="language-yaml"># Development backup
apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: dev-backup
spec:
  sourcePvc: &quot;shared-data&quot;
  secretName: &quot;dev-storage&quot;
---
# Production backup
apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: prod-backup
spec:
  sourcePvc: &quot;shared-data&quot;
  secretName: &quot;prod-storage&quot;
</code></pre>
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="access-control">Access Control</h3>
<ul>
<li>Clone creation requires PVC creation permissions</li>
<li>Clones inherit security context from operator</li>
<li>Ensure proper RBAC for clone management</li>
</ul>
<h3 id="data-security">Data Security</h3>
<ul>
<li>Clones contain exact copy of source data</li>
<li>Apply same security policies as source PVC</li>
<li>Consider encryption for sensitive data</li>
</ul>
<h3 id="cleanup-security">Cleanup Security</h3>
<ul>
<li>Ensure proper deletion of clones</li>
<li>Verify data scrubbing policies</li>
<li>Monitor clone lifecycle for compliance</li>
</ul>
<h2 id="monitoring-clone-operations">Monitoring Clone Operations</h2>
<h3 id="metrics">Metrics</h3>
<p>The operator provides metrics for clone operations:</p>
<ul>
<li><code>datamover_operations_total{phase="CreatingClonedPVC"}</code></li>
<li><code>datamover_phase_duration_seconds{phase="CreatingClonedPVC"}</code></li>
</ul>
<h3 id="logging">Logging</h3>
<p>Monitor clone operations through operator logs:</p>
<pre><code class="language-bash">kubectl logs -n datamover-operator-system deployment/datamover-operator-controller-manager | grep -i &quot;clone\|pvc&quot;
</code></pre>
<h3 id="status-tracking">Status Tracking</h3>
<p>Check clone status through DataMover resource:</p>
<pre><code class="language-bash">kubectl get datamover -o wide
kubectl describe datamover &lt;datamover-name&gt;
</code></pre>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>