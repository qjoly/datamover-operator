<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Container Image Configuration - Datamover Operator</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">Datamover Operator</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">Welcome aboard!</a>
<li class="chapter" data-path="automatic-cleanup/">
<a href="../automatic-cleanup/">Automatic Cleanup</a>
<li class="chapter active" data-path="container-image-configuration/">
<a href="./">Container Image Configuration</a>
<li class="chapter" data-path="data-synchronization/">
<a href="../data-synchronization/">Data Synchronization</a>
<li class="chapter" data-path="metrics-and-monitoring/">
<a href="../metrics-and-monitoring/">Metrics and Monitoring</a>
<li class="chapter" data-path="pvc-cloning/">
<a href="../pvc-cloning/">PVC Cloning</a>
<li class="chapter" data-path="timestamp-organization/">
<a href="../timestamp-organization/">Timestamp Organization</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="container-image-configuration">Container Image Configuration</h1>
<p>Both <code>DataMover</code> and <code>DataMoverSchedule</code> support custom container image configuration through the <code>image</code> field. This allows you to use custom rclone images or different versions.</p>
<h2 id="image-specification">Image Specification</h2>
<p>The <code>image</code> field has three sub-fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>repository</code></td>
<td>string</td>
<td><code>ghcr.io/qjoly/datamover-rclone</code></td>
<td>Full container image repository including registry</td>
</tr>
<tr>
<td><code>tag</code></td>
<td>string</td>
<td><code>latest</code></td>
<td>Image tag or version</td>
</tr>
<tr>
<td><code>pullPolicy</code></td>
<td>string</td>
<td><code>Always</code></td>
<td>Kubernetes image pull policy</td>
</tr>
</tbody>
</table>
<h2 id="pull-policies">Pull Policies</h2>
<p>Valid values for <code>pullPolicy</code>:</p>
<ul>
<li><strong><code>Always</code></strong>: Always pull the image, even if it exists locally</li>
<li><strong><code>IfNotPresent</code></strong>: Only pull if the image doesn't exist locally</li>
<li><strong><code>Never</code></strong>: Never pull the image, use local copy only</li>
</ul>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="default-configuration">Default Configuration</h3>
<p>When no <code>image</code> field is specified, the operator uses defaults:</p>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: default-image-example
spec:
  sourcePvc: &quot;my-data&quot;
  secretName: &quot;storage-secret&quot;
  # No image field = uses defaults:
  # image:
  #   repository: &quot;ghcr.io/qjoly/datamover-rclone&quot;
  #   tag: &quot;latest&quot;
  #   pullPolicy: &quot;Always&quot;
</code></pre>
<h3 id="custom-image-with-specific-tag">Custom Image with Specific Tag</h3>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: custom-image-example
spec:
  sourcePvc: &quot;my-data&quot;
  secretName: &quot;storage-secret&quot;
  image:
    repository: &quot;ghcr.io/qjoly/datamover-rclone&quot;
    tag: &quot;v1.65.0&quot;
    pullPolicy: &quot;IfNotPresent&quot;
</code></pre>
<h3 id="private-registry-image">Private Registry Image</h3>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: private-registry-example
spec:
  sourcePvc: &quot;my-data&quot;
  secretName: &quot;storage-secret&quot;
  image:
    repository: &quot;my-company.com/tools/rclone&quot;
    tag: &quot;enterprise-v2.1.0&quot;
    pullPolicy: &quot;Always&quot;
</code></pre>
<h2 id="datamoverschedule-examples">DataMoverSchedule Examples</h2>
<h3 id="production-schedule-with-stable-image">Production Schedule with Stable Image</h3>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMoverSchedule
metadata:
  name: production-backup
spec:
  schedule: &quot;0 2 * * *&quot;
  sourcePvc: &quot;production-data&quot;
  secretName: &quot;backup-credentials&quot;
  image:
    repository: &quot;ghcr.io/qjoly/datamover-rclone&quot;
    tag: &quot;v1.65.0&quot;           # Pinned version for stability
    pullPolicy: &quot;IfNotPresent&quot;  # Avoid unnecessary pulls
  successfulJobsHistoryLimit: 7
</code></pre>
<h3 id="testing-schedule-with-latest-features">Testing Schedule with Latest Features</h3>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMoverSchedule
metadata:
  name: testing-backup
spec:
  schedule: &quot;0 */6 * * *&quot;  # Every 6 hours
  sourcePvc: &quot;test-data&quot;
  secretName: &quot;test-credentials&quot;
  image:
    repository: &quot;ghcr.io/qjoly/datamover-rclone&quot;
    tag: &quot;latest&quot;
    pullPolicy: &quot;Always&quot;    # Always get latest features
  successfulJobsHistoryLimit: 3
</code></pre>
<h2 id="custom-images-for-alternative-software">Custom Images for Alternative Software</h2>
<p>While DataMover was designed with rclone in mind, it's possible to use custom container images that implement other backup or data synchronization tools. This flexibility allows you to integrate your preferred data management software while leveraging DataMover's PVC cloning and job orchestration capabilities.</p>
<h3 id="requirements-for-custom-images">Requirements for Custom Images</h3>
<p>Any custom image used with DataMover must comply with the following requirements:</p>
<ol>
<li><strong>Data Location</strong>: The image must expect source data to be mounted at <code>/data/</code></li>
<li><strong>Configuration via Environment Variables</strong>: All configuration must be provided through environment variables (no config files)</li>
<li><strong>Exit Codes</strong>: Must use standard exit codes (0 for success, non-zero for failure)</li>
<li><strong>Signal Handling</strong>: Should handle SIGTERM gracefully for clean shutdown</li>
</ol>
<h3 id="environment-variables">Environment Variables</h3>
<p>Your custom image will receive all environment variables from the secret specified in <code>secretName</code>, plus any additional variables defined in <code>additionalEnv</code>. Common patterns include:</p>
<ul>
<li>Storage credentials (AWS keys, API tokens, etc.)</li>
<li>Destination configuration (bucket names, endpoints, etc.)</li>
<li>Behavioral flags and options</li>
</ul>
<h3 id="feature-compatibility-limitations">Feature Compatibility Limitations</h3>
<p>⚠️ <strong>Important</strong>: Some DataMover features may not work with custom images, depending on the software implementation:</p>
<ul>
<li><strong><code>addTimestampPrefix</code></strong>: Only works if your image supports creating timestamped directory structures</li>
<li><strong>Error handling</strong>: Different tools may handle errors differently</li>
</ul>
<h3 id="example-custom-image-with-rsync">Example: Custom Image with rsync</h3>
<pre><code class="language-dockerfile">FROM alpine:3.18

# Install rsync and required tools
RUN apk add --no-cache rsync openssh-client

# Custom entrypoint script (that handles rsync)
COPY entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/entrypoint.sh

USER backup
WORKDIR /data

ENTRYPOINT [&quot;/usr/local/bin/entrypoint.sh&quot;]
</code></pre>
<h3 id="example-custom-image-configuration">Example: Custom Image Configuration</h3>
<pre><code class="language-yaml">apiVersion: datamover.a-cup-of.coffee/v1alpha1
kind: DataMover
metadata:
  name: custom-backup-tool
spec:
  sourcePvc: &quot;my-data&quot;
  secretName: &quot;backup-credentials&quot;
  image:
    repository: &quot;my-registry.com/custom-backup&quot;
    tag: &quot;v2.1.0&quot;
    pullPolicy: &quot;IfNotPresent&quot;
  # Note: addTimestampPrefix may not work with custom tools
  addTimestampPrefix: false
  additionalEnv:
    - name: &quot;BACKUP_MODE&quot;
      value: &quot;incremental&quot;
    - name: &quot;COMPRESSION&quot;
      value: &quot;gzip&quot;
</code></pre>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>